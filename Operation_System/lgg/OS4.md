# 4강

# 스레드 (Thread)

---

[https://velog.io/@aeong98/운영체제OS-프로세스와-스레드](https://velog.io/@aeong98/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9COS-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EC%8A%A4%EB%A0%88%EB%93%9C)

**프로세스 vs 스레드**

- 프로세스 : 운영체제로부터 **자원을 할당**받은 작업(job)의 단위
- 스레드 : 프로세스가 할당받은 **자원을 이용하는 **실행(동작) 흐름의 단위.** 프로세스와 다르게 스레드 간 **메모리를 공유하며 작동**

**스레드가 독립적으로 가지고 있는 부분**

- program counter(실행 흐름)
- register set
- **stack** 메모리 공간

**스레드가 동료 스레드와 공유하는 부분**

- code 메모리 영역
- data 메모리 영역
- OS 자원

OS는 프로세스마다 독립된 메모리 영역(Code,Data,Stack,Heap)을 할당한다. 그래서 프로세스는 다른 프로세스의 변수나 자료에 접근할 수 없다.

하지만 스레드는 하나의 프로세스의 여러 실행 단위이므로, 프로세스가 할당받은 메모리 영역 내에서 Stack 메모리 영역만 따로 할당받고, 나머지 Code,Data,Heap 영역은 동료 스레드들과 **공유**하게 됨.

**이런 방식으로 스레드가 메모리를 공유할 수 밖에 없는 이유**

스레드는 “흐름(동작)의 단위”로 CPU 입장에서 최소 작업 단위가 된다. 하지만 운영체제 OS는 스레드 단위까지 직접 작업 X. 운영체제의 최소 작업 단위는 프로세스이다.

그래서 하나의 프로세스가 여러 개의 스레드를 가질 수 있게 되며, OS에게 할당받은 자원들과 메모리 영역을 여러 스레드가 공유할 수 있게 됨.

**멀티스레드(여러 스레드)의 장점**

1. context switching이 일어날 때 이미 공유하고 있는 메모리만큼 **메모리 자원을 아낄** 수 있다.
2. 스레드는 프로세스 내의 Stack 영역(스레드마다 고유)을 제외한 모든 메모리를 공유하기 때문에 통신 부담이 적어짐. 그래서 **응답 시간도 빠름.**

**멀티스레드의 단점**

1. 스레드 하나가 프로세스 내 자원을 망쳐버린다면 프로세스 전체가 종료될 수 있다. 메모리를 공유하기 때문
2. 자원(메모리)을 공유하기 때문에 필연적으로 **동기화 문제 발생.** 자원은 하나지만 여러 스레드들이 접근해서 값을 쓰게 되므로 이런 동기화 문제가 발생함.

**정말로 프로세스 간에는 다른 메모리 공간을 사용해서 정보 공유가 불가능한지?**

사실 **IPC 통신**이라는 것이 존재한다. Inter Process Communication (프로세스간 소통)

IPC 통신 2가지 기법

1. Shared Memory 기법
    
    최초에 OS Kernel에게 프로세스들끼리 소통하고 싶다고 알리고, 공통 메모리 영역을 할당 받음. 그 이후엔 Kernel 개입 없이 서로 자원 공유
    
2. Message Passing 기법
    
    Kernel에게 부탁해서 Kernel을 거쳐서 프로세스 간 data를 주고받는 기법 
    

지금까지 생각한 건 **사용자 수준 스레드 (User Thread)** 이다. Kernel은 스레드의 존재를 모르고 프로세스 단위로 자원 할당함. 그래서 스레드 간 메모리 공유하며 유연한 context switching이 가능하고 메모리 낭비를 줄일 수 있다. 하지만 하나의 스레드가 block되면 그 프로세스의 다른 스레드들도 block되는 단점 있음.

하지만 **커널 수준 스레드 (Kernel Thread)**도 있긴 하더라.

OS가 직접 스레드를 관리. 스레드마다 자원 할당해서 context switching overhead가 커짐.

하나의 스레드가 block되어도, 다른 스레드들은 개별로 커널에 의해 자원 할당받고 있으므로 계속해서 작업 수행 가능하다는 장점.

그래서 User Thread + Kernel Thread ⇒ n:m thread

근데 커널 수준 스레드, 다대다 스레드는 굳이 생각 안해도 될듯? 면접에서도 잘 안 물어보고
